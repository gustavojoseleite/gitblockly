<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Git: Aprendendo a utilizar o Git através da ferramenta Blockly</title>

  <script src="../../blockly_compressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../javascript_compressed.js"></script>
  <script src="../../msg/js/en.js"></script>
  
  <script src="codeParser.js"></script>
  <link rel="stylesheet" type="text/css" href="modalStyle.css">
  
  <script src="scripts/clone.js"></script>
  <script src="scripts/initi.js"></script>
  <script src="scripts/add.js"></script>
  <script src="scripts/config.js"></script>
  <script src="scripts/commit.js"></script>

  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>
<body>
  <h1 style="text-align: center;">Blockly Git v.Alpha</h1>


  <div style="width: 100% ">
    <div id="blocklyDiv"
        style="display: inline-block; height: 480px; width: 49%"></div>
	<!--<textarea id="output" disabled="disabled"
        style="display: inline-block; height: 480px; width: 28%;">
    </textarea>-->
	
	<div
    style="display: inline-block; height: 480px; width: 35%; ">
    
		<div
		style="overflow: scroll; height: 96%; width: 100%;">
		<pre id="preId"><code id="output"></code></pre>
		</div>
		
			<div style="display:flex;justify-content:center;align-items:center;padding-top: 1%;">
				
				<a class="btn" style="cursor: pointer;" onclick="showCode();"><<</a>
				<a class="btn" style="cursor: pointer;" onclick="showCode();">Gerar</a>
				<a class="btn" style="cursor: pointer;" onclick="showCode();">>></a>
				<!--<input type="button" title="Voltar missão!" onclick="zerarTudo()" value="<<" style="margin-right: auto;width: 100px;height: 28px;">
				<input type="button" title="Gerar e Testar o código!" onclick="showCode()" value="Gerar" style="margin-left: auto;margin-right: auto;width: 100px;height: 28px;">
				<input type="button" title="Próxima Missão!" onclick="showCode()" value=">>" style="margin-left: auto;width: 100px;height: 28px;">-->
			</div>
	</div>
	
	
	<div id="textAreaContainer"
		style="display: inline-block; height: 480px; width: 15%">
		<!--<div
			style="display: table-row; height: 360px; width: 100%">
			<textarea id="roteiro" disabled="disabled"
				style="overflow: auto; display: block; height: 360px; width: 100%;">
			</textarea>
		</div>
		-->
		<div
			style="display: table-row; height: 100%; width: 100%">
		<code contenteditable="false">
			<div id="statsDiv"><span id="val" style="display: inline-block; color: blue">Variáveis</span></div>
			<div id="statsDiv0">Diretório: <span style="color: green">Nda</span></div>
			<div id="statsDiv1">Username: <span style="color: green">Nda</span></div>
			<div id="statsDiv2">User Email: <span style="color: green">Nda</span></div>
			<div id="statsDiv3">Rep. Iniciado: <span style="color: green">Nda</span></div>
			<div id="statsDiv4">Rep. Remoto: <span style="display: inline-block; color: green">Nda</span></div>
			<div id="statsDiv5">Index: <span id="val50" style="display: inline-block; color: green">Nda</span></div>
			<div id="statsDiv6">Arquivos: <span id="val60" style="display: inline-block; color: green">Nda</span></div>
			<div id="statsDiv7"><span id="val60" style="display: inline-block; color: green"></span></div>
			
			
		</code>
		</div>
	</div>
  </div>

<div class="container">
  <div class="interior">
    <a class="btn" href="#open-modal">Ajuda!</a>
  </div>
</div>
<div id="open-modal" class="modal-window">
  <div>
    <a href="#modal-close" title="Close" class="modal-close">Close</a>
    <h1>Olá!</h1>
    <div>
	<span >Como Usar:</span>
<span class="modal-span">Na tela à sua esquerda você coloca os seus blocos: Clique nas abas em baixo de Comandos, nelas estão os blocos! Clique/Arraste-os para usá-los!</span>
<span class="modal-span">A tela à sua direita é apresentada a missão que você deve seguir: Quando terminar de montar os blocos, clique em "Gerar" para verificar seu código.</span>
<span class="modal-span">"<<" e ">>" navegam pelas missões.</span>
<span style="display: block;"></span>
<span style="display: block;">Siga as missões apresentadas e aprenda a usar Git!</span>
	</div>
    </div>
</div>

  <xml id="toolbox" style="display: none">
    <category name="COMANDOS" colour="210">...</category>
    <category name="Para repositórios">
      <block type="config"></block>
      <block type="initi"></block>
      <block type="clone"></block>
    </category>
    <category name="Sobre repositorios">
      <block type="add"></block>
      <block type="commit"></block>
    </category>
    <category name="Outras opções">
      <block type="endereço_repositório"></block>
      <block type="comentario"></block>
      <block type="arquivo"></block>
      <block type="arq"></block>
      <block type="diretório"></block>
      <block type="nome_email"></block>
      <block type="criar_arquivo"></block>
      <block type="modificar_arquivo"></block>
    </category>
  </xml>
  <xml id="startBlocks" style="display: none">
  	<!
    <block type="controls_if" inline="false" x="20" y="20">
      <mutation else="1"></mutation>
      <value name="IF0">
        <block type="logic_compare" inline="true">
          <field name="OP">EQ</field>
          <value name="A">
            <block type="math_arithmetic" inline="true">
              <field name="OP">MULTIPLY</field>
              <value name="A">
                <block type="math_number">
                  <field name="NUM">6</field>
                </block>
              </value>
              <value name="B">
                <block type="math_number">
                  <field name="NUM">7</field>
                </block>
              </value>
            </block>
          </value>
          <value name="B">
            <block type="math_number">
              <field name="NUM">42</field>
            </block>
          </value>
        </block>
      </value>
      <statement name="DO0">
        <block type="text_print" inline="false">
          <value name="TEXT">
            <block type="text">
              <field name="TEXT">Don't panic</field>
            </block>
          </value>
        </block>
      </statement>
      <statement name="ELSE">
        <block type="text_print" inline="false">
          <value name="TEXT">
            <block type="text">
              <field name="TEXT">Panic</field>
            </block>
          </value>
        </block>
      </statement>
    </block>
    >
  </xml>

  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
        {media: '../../media/',
         toolbox: document.getElementById('toolbox')});
    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),
                               demoWorkspace);
    //var outputArea = document.getElementById('output');	
		
	//Stats
	var stats = {
	curDir: '/home',
	isInit: false,
	userName: 'Nda',
	userEmail: 'Nda',
	branch: 'Nda',
	repRemoto: 'Nda',
	index: [], //{filename: "", modified: false, staged: false}
	files: [], //{filename: ""}
	missionNumber: 0,
	valid: false};
	
	
	
	var msg = '';
	document.getElementById('output').innerHTML = msgMission();
	showStats();
    
	//----------------------
	function verifyCodeAndStats(){
		
	}
	
	function msgMission() {
	var mission = '';
		
		switch(stats.missionNumber){
			case 0:
				mission = '<span style="display: inline-block; color: Black">'+'---------------------------//---------------------------'+ '</span>'+'\n';
				break;
			default:
				mission = '<span style="display: inline-block; color: Black">'+'Erro!\n\n'+ '</span>'+'\n';
			
		}
	
    	
		return(mission);
    }
	//------------------------------------------------------
    function showCode() {
	
	  zerarTudo()
	
	  var alert = false;
	  var msg = '';
	  //debugger;
      // Generate Git code and display it.
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      //Trata blocos desconectados
      if(code.search(";")>=0){
		alert = true;
        msg = "#!Existem blocos desconectados!";
		window.alert("Existem blocos desconectados!");
      }  
      
      
	
	
	//---------------------------------------
		//Casos de Teste!
	  var g = '#Criar arquivoTeste1'
	  var h = '#Criar arquivoTeste1\n#Criar arquivoTeste2\n#Modificar arquivoTeste1\n#Modificar arquivoTeste2\n'
	  //i..
	  //j..
	  var k = 'git commit -m -a "Comentario Teste!"';
	  var l = 'git commit -a -m "Comentario Teste!"';
	  var m = 'git commit -m "Comentario Teste!"';
	  var n = 'git commit -a';	  
	  var o = 'git commit';
      var p = 'git init\ngit clone gitTest.com/repo\ngit init\n';		
	  var q = 'git add ArquivoTeste1 ArquivoTeste1 ArquivoTeste2\n';
	  var r = 'git add ArquivoTeste1 ArquivoTeste1\n';	
	  var s = 'git add ArquivoTeste1 ArquivoTeste2\n';
	  var t = 'git add ArquivoTeste1\n';	  
	  var u = 'git clone gitTest.com/repo\ngit clone gitTest.com/repo2\n'; //2x clone
	  var v = 'git init\ngit clone gitTest.com/repo\n'; //Init + Clone
	  var w = 'git clone gitTest.com/repo\n'; //Clone
	  var x = 'git config --global user.name gui\ngit config --global user.email upa@teste\ngit init\ngit init'; //name+email+ 2xInit
	  var y = 'git config --global user.name gui\ngit config --global user.email upa@teste\n'; //name+email
	  var z = 'git init\n'; //Init
	  var omega = 'git config --global user.name gui\ngit config --global user.email upa@teste\ngit init\n#Criado: ArquivoTeste1\n#Criado: ArquivoTeste2\ngit add ArquivoTeste1 ArquivoTeste2\ngit commit -a -m "Comentario Teste!"\n#Modificado: ArquivoTeste1\n#Modificado: ArquivoTeste2\ngit commit -a -m "Comentario Teste2!"\n';
	  
	//----------------------------------------------
	
	
	if(!alert){
	  msg = parseCode(omega);
	  showStats();
	  }
	  
	  msg = parseMsgToHtml(msg);
	  document.getElementById('output').innerHTML = msgMission() + msg;
    }

    function runCode() {
      // Generate JavaScript code and run it.
      window.LoopTrap = 1000;
      Blockly.JavaScript.INFINITE_LOOP_TRAP =
          'if (--window.LoopTrap == 0) throw "Infclonae loop.";\n';
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      try {
        eval(code);
      } catch (e) {
        alert(e);
      }
    }
  </script>

</body>
</html>
